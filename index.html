<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Con la Sombra de Pedro</title>
<style>
  :root{--card-bg:#fff;--accent:#0f62fe;--btn:#000;--muted:#666}
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    font-family:Inter, Arial, sans-serif;
    background:#f3f4f6;
    padding:20px;
  }
  .wrap{
    width:100%;
    max-width:520px;
  }
  .card{
    background:var(--card-bg);
    border-radius:14px;
    box-shadow:0 8px 30px rgba(12,12,14,0.06);
    padding:26px;
    text-align:center;
  }
  h1{margin:0 0 6px;font-size:22px}
  p.lead{margin:0 0 18px;color:var(--muted);font-size:14px}
  .field{margin-bottom:12px}
  select,input{
    width:100%;
    padding:12px 14px;
    border-radius:10px;
    border:1px solid #e2e8f0;
    font-size:15px;
  }
  .row{display:flex;gap:10px}
  .hidden{display:none}
  button.primary{
    width:100%;
    padding:13px;
    border-radius:10px;
    border:0;
    background:var(--btn);
    color:#fff;
    font-size:16px;
    cursor:pointer;
  }
  .note{
    margin-top:14px;
    padding:12px;
    background:#fff8e6;
    border-radius:10px;
    border-left:4px solid #ffd24d;
    color:#5a4a00;
    font-size:14px;
    line-height:1.2;
  }
  /* video area */
  #videoArea{margin-top:20px; display:none; text-align:center}
  .video-frame{width:100%;border-radius:10px;overflow:hidden}
  .download-btn{
    display:inline-block;
    margin-top:14px;
    padding:12px 18px;
    background:var(--accent);
    color:white;
    text-decoration:none;
    border-radius:10px;
    font-weight:600;
  }

  /* responsive tweaks */
  @media(max-width:420px){
    h1{font-size:20px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main" aria-labelledby="title">
      <h1 id="title">Con la Sombra de Pedro</h1>
      <p class="lead">Deja tu correo o número y accede al video.</p>

      <!-- FORM: un solo cuadro (elige email o celular) -->
      <form id="leadForm" class="form">
        <div class="field">
          <select id="tipo" name="tipo" required aria-label="Tipo de dato">
            <option value="">Elegir dato a registrar</option>
            <option value="email">Correo electrónico</option>
            <option value="celular">Número de celular</option>
          </select>
        </div>

        <!-- country select; hidden hasta que elijan celular -->
        <div class="field hidden" id="countryWrap">
          <select id="countryCode" name="codigo" aria-label="Código país">
            <option value="">Seleccionar país (código)</option>
            <!-- Lista compacta inicial; puedes ampliar -->
            <option value="+1">Estados Unidos (+1)</option>
            <option value="+52">México (+52)</option>
            <option value="+51">Perú (+51)</option>
            <option value="+57">Colombia (+57)</option>
            <option value="+44">Reino Unido (+44)</option>
            <option value="+34">España (+34)</option>
            <!-- Si quieres más países, agregar aquí -->
          </select>
        </div>

        <div class="field">
          <input id="dato" name="dato" type="text" placeholder="Escribe aquí..." required aria-label="Dato">
        </div>

        <div class="field">
          <button class="primary" type="submit" id="submitBtn">Enviar</button>
        </div>
      </form>

      <!-- Mensaje + botón que aparece tras enviar -->
      <div id="afterBox" class="hidden" aria-live="polite">
        <div class="note" id="noteText">
          ⚠️ <strong>IMPORTANTE:</strong> Al presionar el botón se abrirá una página (publicidad). 
          Si sale publicidad, vuelve a esta pestaña y presiona <strong>VER VIDEO AHORA</strong> para reproducir el video.
        </div>

        <div style="margin-top:12px">
          <button id="verBtn" class="primary" type="button">VER VIDEO</button>
        </div>
      </div>

      <!-- VIDEO area (oculto hasta segundo click) -->
      <div id="videoArea" aria-hidden="true">
        <div class="video-frame" id="videoFrame">
          <!-- Rumble embed (NO se muestra hasta el segundo click) -->
          <iframe class="rumble" width="640" height="360"
            src="about:blank" frameborder="0" allowfullscreen id="rumbleIframe"
            ></iframe>
        </div>

        <!-- Botón descargar (oculto si no defines enlace) -->
        <a id="downloadLink" class="download-btn hidden" href="#" download>⬇️ Descargar video</a>
      </div>

    </div>
  </div>

<script>
/* ---------- CONFIGURA ESTOS VALORES ---------- */
/* Smartlink que se abrirá en nueva pestaña en el primer click */
const SMARTLINK = "https://otieu.com/4/10211991";

/* Rumble iframe real (se inyecta solo en el segundo click)
   usa el src que me diste: https://rumble.com/embed/v6zsmu6/?pub=4ns49a
*/
const RUMBLE_SRC = "https://rumble.com/embed/v6zsmu6/?pub=4ns49a";

/* Enlace de descarga del video (pon aquí la URL de descarga real).
   Si lo dejas como "#" el botón no se mostrará.
*/
const DOWNLOAD_URL = "https://TU_SERVIDOR_O_ALMACENAMIENTO/video.mp4";
/* --------------------------------------------- */

const form = document.getElementById("leadForm");
const tipo = document.getElementById("tipo");
const countryWrap = document.getElementById("countryWrap");
const countryCode = document.getElementById("countryCode");
const dato = document.getElementById("dato");
const afterBox = document.getElementById("afterBox");
const verBtn = document.getElementById("verBtn");
const rumbleIframe = document.getElementById("rumbleIframe");
const videoArea = document.getElementById("videoArea");
const downloadLink = document.getElementById("downloadLink");

// Mostrar/ocultar selector país
tipo.addEventListener("change", () => {
  if (tipo.value === "celular") {
    countryWrap.classList.remove("hidden");
    dato.placeholder = "Número de celular (sin código)";
    dato.inputMode = "numeric";
  } else {
    countryWrap.classList.add("hidden");
    dato.placeholder = "Correo electrónico";
    dato.inputMode = "email";
  }
});

// Envío: POST a send.php (igual que tienes)
form.addEventListener("submit", (e) => {
  e.preventDefault();
  const formData = new FormData(form);

  // Validación simple adicional
  if (formData.get("tipo") === "") {
    alert("Selecciona 'Correo' o 'Número'.");
    return;
  }
  if (formData.get("dato").trim() === "") {
    alert("Escribe el dato solicitado.");
    return;
  }

  // Enviar a send.php (backend que ya tienes)
  fetch("send.php", {
    method: "POST",
    body: formData
  })
  .then(r => r.text())
  .then(() => {
    // Ocultar form y mostrar afterBox
    form.classList.add("hidden");
    afterBox.classList.remove("hidden");

    // preparar comportamiento del botón VER VIDEO
    setupVerBtn();
  })
  .catch(err => {
    console.error(err);
    alert("Error al enviar. Intenta nuevamente.");
  });
});

function setupVerBtn() {
  let firstClick = true;

  // Cambia texto a algo instructivo
  verBtn.textContent = "VER VIDEO";

  verBtn.onclick = function() {
    if (firstClick) {
      // 1) Abrir smartlink en pestaña nueva
      window.open(SMARTLINK, "_blank", "noopener");

      // Indicar al usuario que vuelva y haga segundo click
      verBtn.textContent = "VOLVER A ESTA PESTAÑA Y PRESIONAR AQUÍ";
      firstClick = false;

      // Opcional: mostrar nota ya puesta (no hay cambio)
      return;
    }

    // Segundo click → cargar iframe del video y mostrar el área de video
    rumbleIframe.src = RUMBLE_SRC;
    videoArea.style.display = "block";
    videoArea.setAttribute("aria-hidden", "false");
    // desplazar un poco hacia el video
    setTimeout(()=>{ location.hash = "videoArea"; }, 200);

    // Mostrar botón descargar si DOWNLOAD_URL está configurado (no "#")
    if (DOWNLOAD_URL && DOWNLOAD_URL !== "#" && DOWNLOAD_URL.trim() !== "") {
      downloadLink.href = DOWNLOAD_URL;
      downloadLink.classList.remove("hidden");
    } else {
      downloadLink.classList.add("hidden");
    }

    // cambiar texto final del verBtn
    verBtn.textContent = "YA PUEDES VER EL VIDEO";
  };
}

/* --- Nota: si quieres que la lista de países sea completa,
   dime y te la agrego completa. --- */
</script>
</body>
</html>
